#!/bin/sh

depth=$1

dirs=$(find . -mindepth $depth -maxdepth $depth -type d | sort -V)

for d in $dirs; do

    if [[ ! -f $d/hminus.log ]]; then

        echo $d: no hminus log

        continue

    fi

    noconv=$(grep 'MAX. NUMBER OF JOBS EXCEEDED' $d/hminus.log)

    conv=$(grep 'MODEL FINALLY CONVERGED' $d/hminus.log)

    lte=$(grep 'END OF LTE RUN' $d/hminus.log)

    if [[ ! -z $noconv ]]; then

        echo $d: no convergence

        continue

    elif [[ -z $conv ]] && [[ -z $lte ]]; then

        echo $d: hminus fail

        continue

    elif [[ ! -f $d/fioss.log ]]; then

        echo $d: no fioss log

        continue

    fi

    fail=$(grep -i fail $d/fioss.log)

    if [[ ! -z $fail ]]; then

        echo $d: fioss fail

        continue

    fi

    if [[ ! -f $d/spec.out ]]; then

        echo $d: no spectrum

        continue

    fi

done
